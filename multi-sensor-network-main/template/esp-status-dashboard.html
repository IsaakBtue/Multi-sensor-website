<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ESP Status Overview</title>
    <style>
      :root {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        color: #1f2933;
        background-color: #f5f7fa;
      }

      * {
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 24px;
      }

      .dashboard {
        width: min(1200px, 100%);
        display: grid;
        grid-template-columns: 2fr 0.9fr;
        gap: 24px;
        background: #fff;
        border-radius: 24px;
        padding: 32px;
        box-shadow: 0 25px 65px rgba(15, 23, 42, 0.12);
      }

      .building-wrapper {
        position: relative;
        border-radius: 32px;
        background: #fff;
        border: 1px solid #e1e5ec;
        padding: 24px;
      }

      .building-grid {
        position: relative;
        width: 100%;
        padding-top: 65%;
        background: radial-gradient(circle at center, #fdfdfd 0%, #f3f6fb 100%);
        border-radius: 24px;
        border: 1px dashed #d7dde8;
        overflow: hidden;
      }

      .esp-point {
        position: absolute;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        transform: translate(-50%, -50%);
        border: 2px solid rgba(255, 255, 255, 0.6);
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, opacity 0.2s ease;
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9) 0%, rgba(16, 185, 129, 0.9) 40%, rgba(4, 120, 87, 0.95) 80%);
        box-shadow: 0 0 20px rgba(16, 185, 129, 0.35);
      }

      .esp-point::after {
        content: "";
        position: absolute;
        inset: -8px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(16, 185, 129, 0.35) 0%, transparent 70%);
        opacity: 0.85;
        transition: opacity 0.2s ease;
      }

      .esp-point[data-status="inactive"] {
        background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.9) 0%, rgba(248, 113, 113, 0.95) 45%, rgba(185, 28, 28, 0.95) 80%);
        box-shadow: 0 0 20px rgba(248, 113, 113, 0.35);
      }

      .esp-point[data-status="inactive"]::after {
        background: radial-gradient(circle, rgba(248, 113, 113, 0.35) 0%, transparent 70%);
      }

      .esp-point:hover,
      .esp-point.selected {
        transform: translate(-50%, -50%) scale(1.15);
      }

      .esp-point.selected::after {
        opacity: 1;
      }

      .esp-point .tooltip {
        position: absolute;
        bottom: 150%;
        left: 50%;
        transform: translateX(-50%);
        background: #111827;
        color: #fff;
        padding: 8px 12px;
        border-radius: 12px;
        font-size: 12px;
        min-width: 120px;
        text-align: center;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.15s ease, transform 0.15s ease;
        white-space: nowrap;
      }

      .esp-point:hover .tooltip {
        opacity: 1;
        transform: translate(-50%, -4px);
      }

      .distance-label {
        position: absolute;
        transform: translate(-50%, 18px) scale(0.9);
        font-size: 11px;
        color: #0f172a;
        text-align: center;
        pointer-events: none;
        background: rgba(255, 255, 255, 0.95);
        padding: 4px 8px;
        border-radius: 12px;
        border: 1px solid rgba(148, 163, 184, 0.4);
        opacity: 0;
        transition: opacity 0.2s ease, transform 0.2s ease;
        white-space: nowrap;
      }

      .distance-label.visible {
        opacity: 1;
        transform: translate(-50%, 12px) scale(1);
      }

      .info-panel {
        border-radius: 24px;
        border: 1px solid #e1e5ec;
        background: linear-gradient(180deg, #f9fafb 0%, #f1f5f9 100%);
        padding: 24px;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .panel-section h2 {
        margin: 0 0 12px;
        font-size: 20px;
        font-weight: 600;
      }

      .level-switcher {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .level-button {
        border: 1px solid #d7dde8;
        border-radius: 16px;
        padding: 12px 16px;
        background: #fff;
        color: #1f2933;
        font-size: 15px;
        font-weight: 500;
        cursor: pointer;
        transition: border-color 0.2s ease, color 0.2s ease, background 0.2s ease;
      }

      .level-button:hover {
        border-color: #10b981;
      }

      .level-button.active {
        background: #10b981;
        color: #fff;
        border-color: #10b981;
      }

      .legend {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        font-size: 14px;
      }

      .legend-item {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .legend-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
      }

      .legend-dot.online {
        background: #10b981;
      }

      .legend-dot.offline {
        background: #ef4444;
      }

      .status-summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 12px;
      }

      .summary-card {
        border-radius: 18px;
        padding: 12px 16px;
        background: #fff;
        border: 1px solid #d7dde8;
      }

      .summary-card span {
        font-size: 12px;
        color: #6b7280;
      }

      .summary-card strong {
        display: block;
        font-size: 20px;
        margin-top: 6px;
      }

      .relative-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
        font-size: 14px;
      }

      .relative-item {
        display: flex;
        justify-content: space-between;
        background: #fff;
        border: 1px solid #d7dde8;
        border-radius: 14px;
        padding: 8px 12px;
      }

      .relative-item strong {
        font-weight: 600;
        color: #0f172a;
      }

      .relative-placeholder {
        font-size: 14px;
        color: #94a3b8;
        border: 1px dashed #cbd5f5;
        border-radius: 14px;
        padding: 12px;
        text-align: center;
      }

      @media (max-width: 900px) {
        body {
          padding: 12px;
        }

        .dashboard {
          grid-template-columns: 1fr;
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <main class="dashboard">
      <section class="building-wrapper">
        <div class="panel-section">
          <h2>Facility Map</h2>
          <p style="margin: 0; color: #6b7280; font-size: 14px">
            Hover a sensor to view its name, status and measured distance.
          </p>
          <div class="legend" style="margin-top: 12px">
            <div class="legend-item">
              <span class="legend-dot online"></span>
              Online
            </div>
            <div class="legend-item">
              <span class="legend-dot offline"></span>
              Offline
            </div>
          </div>
        </div>
        <div id="buildingGrid" class="building-grid"></div>
      </section>
      <aside class="info-panel">
        <div class="panel-section">
          <h2>Building Levels</h2>
          <div id="levelSwitcher" class="level-switcher"></div>
        </div>
        <div class="panel-section">
          <h2>Overview</h2>
          <div class="status-summary" id="statusSummary"></div>
        </div>
        <div class="panel-section">
          <h2>Relative Distances</h2>
          <div id="relativeDistances" class="relative-list">
            <div class="relative-placeholder">Select a sensor on the map to compare.</div>
          </div>
        </div>
      </aside>
    </main>

    <script>
      const buildingLevels = [
        {
          id: "level-1",
          label: "Level 1",
          sensors: [
            {
              name: "ESP-North",
              status: "active",
              distance: "12.4 m",
              top: 20,
              left: 25,
            },
            {
              name: "ESP-East",
              status: "active",
              distance: "9.8 m",
              top: 35,
              left: 70,
            },
            {
              name: "ESP-West",
              status: "inactive",
              distance: "15.1 m",
              top: 52,
              left: 18,
            },
            {
              name: "ESP-Lab",
              status: "active",
              distance: "7.2 m",
              top: 55,
              left: 58,
            },
            {
              name: "ESP-Office",
              status: "inactive",
              distance: "5.9 m",
              top: 72,
              left: 40,
            },
            {
              name: "ESP-Storage",
              status: "active",
              distance: "18.6 m",
              top: 78,
              left: 78,
            },
          ],
        },
        {
          id: "level-2",
          label: "Level 2",
          sensors: [
            {
              name: "ESP-North 2",
              status: "active",
              distance: "11.1 m",
              top: 18,
              left: 30,
            },
            {
              name: "ESP-East 2",
              status: "inactive",
              distance: "10.4 m",
              top: 33,
              left: 63,
            },
            {
              name: "ESP-West 2",
              status: "active",
              distance: "8.6 m",
              top: 48,
              left: 20,
            },
            {
              name: "ESP-Lab 2",
              status: "active",
              distance: "6.4 m",
              top: 50,
              left: 57,
            },
            {
              name: "ESP-Office 2",
              status: "inactive",
              distance: "6.8 m",
              top: 65,
              left: 45,
            },
            {
              name: "ESP-Storage 2",
              status: "active",
              distance: "14.2 m",
              top: 75,
              left: 75,
            },
          ],
        },
        {
          id: "level-3",
          label: "Level 3",
          sensors: [
            {
              name: "ESP Research",
              status: "inactive",
              distance: "12.9 m",
              top: 18,
              left: 52,
            },
            {
              name: "ESP South Hall",
              status: "active",
              distance: "20.4 m",
              top: 32,
              left: 75,
            },
            {
              name: "ESP Admin",
              status: "active",
              distance: "9.3 m",
              top: 38,
              left: 33,
            },
            {
              name: "ESP Data Center",
              status: "inactive",
              distance: "17.2 m",
              top: 58,
              left: 65,
            },
            {
              name: "ESP Breakout",
              status: "active",
              distance: "13.7 m",
              top: 68,
              left: 35,
            },
            {
              name: "ESP Atrium",
              status: "active",
              distance: "8.5 m",
              top: 78,
              left: 70,
            },
          ],
        },
      ];

      const buildingGrid = document.getElementById("buildingGrid");
      const levelSwitcher = document.getElementById("levelSwitcher");
      const statusSummary = document.getElementById("statusSummary");
      const relativeDistances = document.getElementById("relativeDistances");
      let currentSensors = [];
      let selectedSensorName = null;

      function renderLevelButtons() {
        levelSwitcher.innerHTML = "";
        buildingLevels.forEach((level, index) => {
          const button = document.createElement("button");
          button.type = "button";
          button.className = `level-button ${index === 0 ? "active" : ""}`;
          button.textContent = level.label;
          button.dataset.levelId = level.id;
          button.addEventListener("click", () => setActiveLevel(level.id));
          levelSwitcher.appendChild(button);
        });
      }

      function setActiveLevel(levelId) {
        document.querySelectorAll(".level-button").forEach((button) => {
          button.classList.toggle("active", button.dataset.levelId === levelId);
        });

        const level = buildingLevels.find((lvl) => lvl.id === levelId);
        if (!level) return;
        renderSensors(level.sensors);
        renderSummary(level.sensors);
      }

      function renderSensors(sensors) {
        currentSensors = sensors;
        selectedSensorName = null;
        buildingGrid.innerHTML = "";
        sensors.forEach((sensor) => {
          const point = document.createElement("div");
          point.className = "esp-point";
          point.style.top = `${sensor.top}%`;
          point.style.left = `${sensor.left}%`;
          point.dataset.status = sensor.status === "active" ? "active" : "inactive";
          point.dataset.sensorName = sensor.name;

          const tooltip = document.createElement("span");
          tooltip.className = "tooltip";
          tooltip.textContent = `${sensor.name} â€¢ ${sensor.status === "active" ? "Online" : "Offline"}`;
          point.appendChild(tooltip);

          const distance = document.createElement("span");
          distance.className = "distance-label";
          point.appendChild(distance);

          point.addEventListener("click", () => handleSensorClick(sensor.name));

          buildingGrid.appendChild(point);
        });
        updateDistanceLabels();
        updateRelativePanel();
      }

      function renderSummary(sensors) {
        const activeCount = sensors.filter((sensor) => sensor.status === "active").length;
        const inactiveCount = sensors.length - activeCount;

        statusSummary.innerHTML = `
          <div class="summary-card">
            <span>Active</span>
            <strong>${activeCount}</strong>
          </div>
          <div class="summary-card">
            <span>Offline</span>
            <strong>${inactiveCount}</strong>
          </div>
          <div class="summary-card">
            <span>Total Distance</span>
            <strong>${sumDistances(sensors)}</strong>
          </div>
        `;
      }

      function sumDistances(sensors) {
        const total = sensors.reduce((sum, sensor) => {
          const value = parseFloat(sensor.distance);
          return Number.isFinite(value) ? sum + value : sum;
        }, 0);
        return `${total.toFixed(1)} m`;
      }

      function handleSensorClick(sensorName) {
        selectedSensorName = sensorName;
        document.querySelectorAll(".esp-point").forEach((point) => {
          point.classList.toggle("selected", point.dataset.sensorName === sensorName);
        });
        updateDistanceLabels();
        updateRelativePanel();
      }

      function updateDistanceLabels() {
        const selected = currentSensors.find((sensor) => sensor.name === selectedSensorName);
        document.querySelectorAll(".distance-label").forEach((label) => {
          label.classList.remove("visible");
          label.textContent = "";
        });
        if (!selected) return;

        currentSensors.forEach((sensor) => {
          const point = buildingGrid.querySelector(`.esp-point[data-sensor-name="${sensor.name}"]`);
          if (!point) return;
          const label = point.querySelector(".distance-label");
          if (!label) return;

          if (sensor.name === selected.name) {
            label.textContent = "0.0 m";
          } else {
            const relative = calculateRelativeDistance(selected, sensor);
            label.textContent = formatMeters(relative);
          }
          label.classList.add("visible");
        });
      }

      function calculateRelativeDistance(sensorA, sensorB) {
        const deltaX = sensorA.left - sensorB.left;
        const deltaY = sensorA.top - sensorB.top;
        const planarDistance = Math.hypot(deltaX, deltaY);
        return planarDistance * 0.6;
      }

      function formatMeters(value) {
        return `${value.toFixed(1)} m`;
      }

      function updateRelativePanel() {
        relativeDistances.innerHTML = "";
        const selected = currentSensors.find((sensor) => sensor.name === selectedSensorName);

        if (!selected) {
          relativeDistances.innerHTML = '<div class="relative-placeholder">Select a sensor on the map to compare.</div>';
          return;
        }

        currentSensors
          .filter((sensor) => sensor.name !== selected.name)
          .map((sensor) => {
            const rawDistance = calculateRelativeDistance(selected, sensor);
            return {
              name: sensor.name,
              value: rawDistance,
              label: formatMeters(rawDistance),
            };
          })
          .sort((a, b) => a.value - b.value)
          .forEach((entry) => {
            const row = document.createElement("div");
            row.className = "relative-item";
            row.innerHTML = `<span>${entry.name}</span><strong>${entry.label}</strong>`;
            relativeDistances.appendChild(row);
          });
      }

      renderLevelButtons();
      setActiveLevel(buildingLevels[0].id);
    </script>
  </body>
</html>

